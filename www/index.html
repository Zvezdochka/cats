<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
    <!--<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.2/dojo/dojo.js" data-dojo-config="async: true"></script> -->
  
    <!--<link href="style.css" type="text/css" rel="stylesheet" />-->
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js?2.9.1"></script>
</head>

<body> 
    <div>  
        <embed id="emb" src="shreda.svg" width="100%" height="100%" type="image/svg+xml" />
    </div>
    <div>
        <embed id="slider_wind" src="slider.svg" width="100%" height="100%" type="image/svg+xml" /><br>
        <embed id="slider_gravity" src="slider.svg" width="100%" height="100%" type="image/svg+xml" />
    </div>
	
    <script>
	    // fetches the document for the given embedding_element
	    function getSubDocument(embedding_element)
	    {
		    if (embedding_element.contentDocument) 
		    {
			    return embedding_element.contentDocument;
		    } 
		    else 
		    {
			    var subdoc = null;
			    try {
				    subdoc = embedding_element.getSVGDocument();
			    } catch(e) {}
			    return subdoc;
		    }
	    }
	    
        var catNames = [];
        var canvas;
         
        function redraw()
        {
            var cats = canvas.selectAll('.cat')
                             .data(catNames)
                             .enter()
                                 .append('use')
                                 .attr('xlink:href', '#shreda')      
                                 .attr('x', function(d, i){return i*200})
                                 .attr('y', 0)
                                 .style('opacity','0')
                                 .classed('cat', true)
                             .transition()
                                 .duration(3000)
                                 .style('opacity', '1') 
                                 .each('end', function() {
                                      d3.select(this)
                                        .transition()
                                            //.delay(function(d, i) { return d3.random.normal(500, 500)(); })
                                            .duration(3000)
                                            .attr('transform', 'translate(0, 250)');
                                 });
        }

	    function findSVG(embed_id)
	    {
		    var obj = document.getElementById(embed_id); 
            var subDoc = getSubDocument(obj);
            var svg = d3.select(subDoc).select('svg');
            return svg;
	    }
	    
        function init()
	    {
			    canvas = findSVG('emb');
			    console.info(canvas);
			    //var sliderWind = findSVG('slider_wind');
			    //var sliderGravity = findSVG('slider_gravity');

                canvas.on('click',function()
                {
                    console.info('ttt');
                    catNames.push('shreda');
                    console.info(catNames);
                    redraw();
                })            
	    }                                   
	    // wait until all the resources are loaded
	    window.addEventListener("load", init, false);
    </script>    
  </body>
</html>